<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯»å‘³äº¬åŸ: äº¤äº’å¼ç¾é£Ÿæ¢ç´¢æŒ‡å— (v4.3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A task-oriented dashboard structure is chosen over the report's linear format to prioritize user-friendliness. The core is an interactive filtering system (by Cuisine, Price, Area) and a card-based layout. This allows users to immediately act on their intent (e.g., "find a mid-range hot pot place") rather than reading through chapters. A "Top Picks" section provides instant value, while a dedicated "Gourmet's Compass" section isolates actionable advice. This non-linear, interactive model is superior for a digital guide as it facilitates quick discovery and comparison, which is the primary goal for someone looking for a restaurant. -->
    <!-- Visualization & Content Choices: Report Info: Table of hot pot restaurants with prices. -> Goal: Compare costs easily. -> Viz/Presentation: Interactive Bar Chart (Chart.js/Canvas). -> Interaction: Hover tooltips show exact prices. -> Justification: A bar chart offers a much faster, more intuitive comparison of quantitative data than a text column in a table, enhancing user understanding. Report Info: Long lists of restaurants. -> Goal: Organize and filter. -> Presentation: Interactive Cards. -> Interaction: Filter buttons (Cuisine, Price, Area) dynamically show/hide cards. -> Justification: Cards are scannable and modular. Filtering is essential for navigating a large dataset (>50 restaurants) and makes the guide genuinely useful. Report Info: Textual advice. -> Goal: Inform. -> Presentation: Dedicated HTML section with clear typography. -> Justification: Separates instructional content from discovery content for clarity. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #FDFBF7;
            color: #38302A;
        }
        .filter-btn {
            transition: all 0.3s ease;
        }
        .filter-btn.active {
            background-color: #D35400;
            color: #FFFFFF;
            font-weight: 700;
        }
        .restaurant-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .restaurant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
        }
        .schedule-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        /* Styles for collapsed filter */
        #filters.collapsed #full-filters-view {
            display: none;
        }
        #filters:not(.collapsed) #selected-filters-display {
             display: none;
        }
        #toggle-filters-btn {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-7xl">

        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-[#A75C3B]">å¯»å‘³äº¬åŸ</h1>
            <p class="mt-2 md:mt-4 text-lg text-gray-600">ä¸€ä»½æ·±åº¦äº¤äº’å¼ç¾é£Ÿæ¢ç´¢æŒ‡å— (v4.3)</p>
        </header>

        <main>
             <section id="filters" class="mb-8 p-6 bg-white/60 backdrop-blur-sm rounded-xl shadow-lg sticky top-0 z-10">
                <div id="selected-filters-display" class="flex flex-wrap items-center gap-2 cursor-pointer" title="ç‚¹å‡»å±•å¼€ç­›é€‰å™¨">
                </div>
                <div id="full-filters-view" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                    <div>
                        <h3 class="font-bold mb-3 text-lg text-[#A75C3B]">èœç³»ç±»åˆ«</h3>
                        <div id="cuisine-filters" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div>
                        <h3 class="font-bold mb-3 text-lg text-[#A75C3B]">äººå‡æ¶ˆè´¹</h3>
                        <div id="price-filters" class="flex flex-wrap gap-2"></div>
                    </div>
                     <div>
                        <h3 class="font-bold mb-3 text-lg text-[#A75C3B]">é€šå‹¤æ—¶é—´</h3>
                        <p class="text-xs text-gray-400 mb-2">(ä»æœé˜³å…¬å›­åœ°é“ç«™å‡ºå‘)</p>
                        <div id="time-filters" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div>
                        <h3 class="font-bold mb-3 text-lg text-[#A75C3B]">è¡Œæ”¿åŒº</h3>
                        <div id="district-filters" class="flex flex-wrap gap-2"></div>
                    </div>
                     <div>
                        <h3 class="font-bold mb-3 text-lg text-[#A75C3B]">ç‰¹åˆ«æ ‡ç­¾</h3>
                        <div id="special-filters" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </section>
            
            <section id="restaurant-list" class="mb-12">
                <h2 class="text-3xl font-bold text-center mb-8 text-[#A75C3B]">ç¾é£Ÿæ¢ç´¢</h2>
                 <p class="text-center text-gray-600 mb-8 max-w-3xl mx-auto">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºæ‚¨æ±‡é›†äº†äº¬åŸçš„å£ç¢‘é¤å…ã€‚å…¶ä¸­å¸¦æœ‰â€œç¥çº§â€å¾½ç« çš„ï¼Œæ˜¯ç»è¿‡å±‚å±‚ç­›é€‰ã€ä¸å®¹é”™è¿‡çš„é¡¶å°–ä¹‹é€‰ã€‚ç°åœ¨ï¼Œå¼€å§‹ä½¿ç”¨ä¸Šæ–¹çš„è¿‡æ»¤å™¨ï¼Œå¯»æ‰¾æ»¡è¶³æ‚¨å£å‘³çš„ä¸‹ä¸€é¤å§ï¼</p>
                <div id="restaurants-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                <p id="no-results" class="text-center text-gray-500 py-10 hidden">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„é¤å…ã€‚</p>
            </section>
            
            <section id="charts" class="mb-12">
                <h2 class="text-3xl font-bold text-center mb-8 text-[#A75C3B]">åŠ¨æ€æ•°æ®çœ‹æ¿</h2>
                <p class="text-center text-gray-600 mb-8 max-w-3xl mx-auto">ä»¥ä¸‹å›¾è¡¨å°†æ ¹æ®æ‚¨çš„ç­›é€‰å®æ—¶å˜åŒ–ï¼Œä¸ºæ‚¨æä¾›ç²¾å‡†çš„æ•°æ®æ´å¯Ÿã€‚</p>
                 <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                    <div class="lg:col-span-2 bg-white/60 p-4 rounded-xl shadow-sm">
                        <h3 class="font-bold text-center mb-4">é¤å…è¯„åˆ†åˆ†å¸ƒ</h3>
                        <div class="chart-container">
                            <canvas id="ratingDistributionChart"></canvas>
                        </div>
                    </div>
                    <div class="lg:col-span-3 bg-white/60 p-4 rounded-xl shadow-sm">
                        <h3 class="font-bold text-center mb-4">é¤å…è¯„åˆ†æ’è¡Œ</h3>
                        <div class="chart-container">
                             <canvas id="ratingRankChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

             <section id="schedule" class="mb-12">
                <h2 class="text-3xl font-bold text-center mb-8 text-[#A75C3B]">ä¸»é¢˜å‘¨æœ«å¯»å‘³è®¡åˆ’</h2>
                <p class="text-center text-gray-600 mb-8 max-w-3xl mx-auto">ä¸ºæ‚¨ç²¾å¿ƒç­–åˆ’çš„ä¸‰ä¸ªä¸»é¢˜å‘¨æœ«ï¼Œå°†ç¾é£Ÿæ¢ç´¢ä¸åŸå¸‚æ–‡åŒ–ä¹‹æ—…å®Œç¾ç»“åˆã€‚</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="schedule-card rounded-lg p-6 shadow-lg">
                        <h3 class="font-bold text-xl text-center text-[#A75C3B] mb-1">ç¬¬ä¸€å‘¨ï¼šä¸­è½´çº¿å†å²ä¹‹æ—…</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">æ¸¸è§ˆï¼šå›½å®¶åšç‰©é¦†</p>
                        <div class="space-y-4">
                            <p class="text-sm text-gray-600">æ¸¸è§ˆå›½åšï¼Œæ„Ÿå—åå¤æ–‡æ˜çš„åšé‡ã€‚å‚æ™šå‰å¾€å‰é—¨æˆ–ç‰›è¡—ï¼Œå“å‘³åœ°é“äº¬å‘³ã€‚</p>
                            <div><p class="font-semibold">åˆé¤ï¼š<span class="font-normal text-gray-700">å¯é€‰æ‹©åœ¨å›½åšå†…ç®€é¤</span></p></div>
                            <div><p class="font-semibold">æ™šé¤ï¼š<span class="font-normal text-gray-700">å—é—¨æ¶®è‚‰ æˆ– èšå®æº</span></p></div>
                        </div>
                    </div>
                    <div class="schedule-card rounded-lg p-6 shadow-lg">
                        <h3 class="font-bold text-xl text-center text-[#A75C3B] mb-1">ç¬¬äºŒå‘¨ï¼šé›„å…³å¤éŸµä¹‹æ—…</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">æ¸¸è§ˆï¼šæ…•ç”°å³ªé•¿åŸ</p>
                        <div class="space-y-4">
                           <p class="text-sm text-gray-600">æ”€ç™»é›„ä¼Ÿé•¿åŸï¼Œä½“éªŒåŒ—å›½é£å…‰ã€‚è¿”ç¨‹é€”ä¸­ï¼Œç”¨ä¸€é¡¿é…£ç•…æ·‹æ¼“çš„çƒ§çƒ¤çŠ’åŠ³è‡ªå·±ã€‚</p>
                            <div><p class="font-semibold">åˆé¤ï¼š<span class="font-normal text-gray-700">æ™¯åŒºé™„è¿‘å†œå®¶èœ</span></p></div>
                            <div><p class="font-semibold">æ™šé¤ï¼š<span class="font-normal text-gray-700">ä¸œç›´é—¨çƒ§çƒ¤ (å›é¾™è§‚åº—)</span></p></div>
                        </div>
                    </div>
                    <div class="schedule-card rounded-lg p-6 shadow-lg">
                         <h3 class="font-bold text-xl text-center text-[#A75C3B] mb-1">ç¬¬ä¸‰å‘¨ï¼šçš‡å®¶å›­æ—ä¹‹æ—…</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">æ¸¸è§ˆï¼šé¢å’Œå›­</p>
                         <div class="space-y-4">
                           <p class="text-sm text-gray-600">æ¼«æ­¥äºçš‡å®¶å›­æ—ï¼Œæ„Ÿå—å±±æ°´ç”»å¢ƒã€‚æ¸¸è§ˆç»“æŸåï¼Œé€‰æ‹©ä¸€å®¶ç²¾è‡´é¤å…ï¼Œäº«å—æƒ¬æ„æ™šé¤ã€‚</p>
                            <div><p class="font-semibold">åˆé¤ï¼š<span class="font-normal text-gray-700">å¬é¹‚é¦† (é¢å’Œå›­å†…)</span></p></div>
                            <div><p class="font-semibold">æ™šé¤ï¼š<span class="font-normal text-gray-700">æ·®æ‰¬åºœ æˆ– é›…å±…å°é¦†</span></p></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="gourmet-compass">
                 <h2 class="text-3xl font-bold text-center mb-8 text-[#A75C3B]">ç¾é£Ÿå®¶æŒ‡å—é’ˆ</h2>
                 <div class="max-w-4xl mx-auto bg-white/60 p-8 rounded-xl shadow-sm">
                     <div class="space-y-8 text-gray-700">
                        <div>
                            <h3 class="font-bold text-xl mb-3 text-[#A75C3B]">ğŸ’¡ è¿é”å“ç‰Œæœ€ä¼˜è§£ (èªæ˜åƒæ³•)</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>å¾ˆä¹…ä»¥å‰</strong>: å“è´¨ç¨³å®šï¼Œæ˜¯å…¥é—¨çº§çƒ§çƒ¤çš„å¯é é€‰æ‹©ã€‚</li>
                                <li><strong>ç”°è€å¸ˆçº¢çƒ§è‚‰</strong>: å…¶ç²¾ååœ¨äº<strong class="text-[#D35400]">æœ¨é¡»è‚‰é¥­</strong>æˆ–<strong class="text-[#D35400]">é¦™è‡é¸¡è…¿é¥­</strong>ã€‚</li>
                                <li><strong>å—äº¬å¤§ç‰Œæ¡£</strong>: é‡ç‚¹åº”æ”¾åœ¨<strong class="text-[#D35400]">ç”œå“ä¸ç‰¹è‰²å°åƒ</strong>ä¸Šã€‚</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-bold text-xl mb-3 text-[#A75C3B]">âš ï¸ é¿å‘ä¸ä¿®æ­£æŒ‡å—</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong class="text-[#D35400]">å…³äºâ€œç´«å…‰å›­â€</strong>: è¿™æ˜¯ä¸€å®¶æ€§ä»·æ¯”é«˜ã€å‘³é“æ­£å®—çš„æ¸…çœŸè€å­—å·ï¼Œå®¶åº­èšé¤çš„ç»ä½³é€‰æ‹©ã€‚</li>
                                <li><strong class="text-[#D35400]">æ¸¸å®¢åŒºé¤å…</strong>: åœ¨ç‹åºœäº•ã€å‰é—¨ç­‰ä¸»è¡—ä¸Šçš„é¤å…éœ€è°¨æ…é€‰æ‹©ã€‚</li>
                                <li><strong class="text-[#D35400]">â€œæ‹›ç‰Œèœâ€é™·é˜±</strong>: ä¸€å®¶é¤å…çš„æ‹›ç‰Œèœæœªå¿…æ˜¯å…¶æœ€å‡ºè‰²çš„äº§å“ã€‚</li>
                            </ul>
                        </div>
                    </div>
                 </div>
            </section>
        </main>
    </div>

    <div id="restaurant-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 invisible opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform scale-95">
            <div class="p-6 md:p-8 relative">
                <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
                <h2 id="modal-name" class="text-2xl md:text-3xl font-bold mb-2 text-[#A75C3B]"></h2>
                <div class="flex flex-wrap items-center gap-x-4 gap-y-2 mb-4 text-sm">
                    <span id="modal-cuisine" class="bg-amber-100 text-amber-800 px-2 py-1 rounded-full font-medium"></span>
                    <span id="modal-price" class="bg-emerald-100 text-emerald-800 px-2 py-1 rounded-full font-medium"></span>
                    <span id="modal-rating" class="font-bold px-2 py-1 rounded-full"></span>
                    <span id="modal-time" class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-medium"></span>
                </div>
                <div class="prose max-w-none text-gray-700">
                    <h4 class="font-bold">é£Ÿå®¢ç‚¹è¯„:</h4>
                    <p id="modal-feature" class="mb-4"></p>
                    <h4 class="font-bold">æ‹›ç‰Œèœå“:</h4>
                    <p id="modal-dishes" class="mb-4"></p>
                    <h4 class="font-bold">åœ°å€:</h4>
                    <p id="modal-address" class="flex items-center">
                        <span class="mr-2">ğŸ“</span>
                        <span id="address-text"></span>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <button id="toggle-filters-btn" class="hidden fixed bottom-6 right-6 bg-[#D35400] text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center z-20 transform hover:scale-110 transition-transform">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>
    </button>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const restaurants = [
                { id: 14, name: 'æ–°ç–†é¥­åº„', cuisine: 'åœ°æ–¹é©»äº¬åŠ', priceSymbol: 'Â¥Â¥', priceValue: 130, district: 'è¥¿åŸ', topPick: true, hasMutton: true, rating: 9.8, travelTime: 50, dishes: 'ç¾Šè‚‰ä¸²ã€å¤§ç›˜é¸¡ã€æ‰‹æŠ“é¥­', feature: 'ç¾Šè‚‰æ¯«æ— è†»å‘³ï¼Œé²œå«©å¤šæ±ï¼Œæ˜¯ä½“éªŒæ­£å®—æ–°ç–†èœçš„å¿…è®¿ä¹‹åœ°ã€‚', address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºè½¦å…¬åº„å¤§è¡—åŒ—é‡Œ1å·' },
                { id: 11, name: 'æ–°å·åŠ', cuisine: 'åœ°æ–¹é©»äº¬åŠ', priceSymbol: 'Â¥Â¥Â¥', priceValue: 160, district: 'ä¸°å°', topPick: true, hasMutton: false, rating: 9.7, travelTime: 70, dishes: 'æ°´ç…®é±¼ã€æ¯›è¡€æ—ºã€è¾£å­é¸¡', feature: 'äº«æœ‰â€œåƒå·èœåˆ°å·åŠâ€çš„ç¾èª‰ï¼Œæ˜¯å·èœçˆ±å¥½è€…çš„åœ£åœ°ã€‚', address: 'åŒ—äº¬å¸‚ä¸°å°åŒºå°çº¢é—¨è·¯312å·' },
                { id: 15, name: 'èŠˆé‡å±±ç«é”…', cuisine: 'é£å‘³ç«é”…', priceSymbol: 'Â¥Â¥', priceValue: 140, district: 'æœé˜³', topPick: true, hasMutton: true, rating: 9.6, travelTime: 25, dishes: 'è„†æ¯›è‚šã€é¸­è‚ ã€é²œé¸­è¡€', feature: 'åŒ—äº¬æœ€æ­£å®—çš„é‡åº†ç«é”…ä¹‹ä¸€ï¼Œåº•æ–™ç”±é‡åº†åˆ¶ä½œï¼Œé£å‘³æµ“éƒã€‚', address: 'åŒ—äº¬å¸‚æœé˜³åŒºç™¾å­æ¹¾è·¯16å·' },
                { id: 19, name: 'è¥¿åºœé¢é¦†', cuisine: 'æ‹›ç‰Œé¢é£Ÿ', priceSymbol: 'Â¥', priceValue: 30, district: 'è¥¿åŸ', topPick: true, hasMutton: false, rating: 9.5, travelTime: 45, dishes: 'è¥¿åºœå‰Šç­‹é¢ã€ç²¾å“è‚‰å¤¹é¦', feature: 'ä¸€å®¶ç»è¥è¶…åå¹´çš„è€åº—ï¼Œå£æ„Ÿæåº¦ç­‹é“ï¼Œæ˜¯â€œå®è—å°é¦†â€çš„å®Œç¾å…¸èŒƒã€‚', address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºè¥¿å››åŒ—å¤§è¡—271å·' },
                { id: 1, name: 'èšå®æº', cuisine: 'äº¬å‘³æ¶®è‚‰', priceSymbol: 'Â¥Â¥', priceValue: 120, district: 'è¥¿åŸ', topPick: false, hasMutton: true, rating: 9.4, travelTime: 55, dishes: 'æ‰‹åˆ‡é²œç¾Šè‚‰ã€ä¸€å“çƒ§é¥¼', feature: 'å…¬è®¤çš„ç»å…¸ä»£è¡¨ï¼Œè‚‰è´¨ä¸Šä¹˜ï¼Œçƒ§é¥¼ä¸€ç»ã€‚åŠ¡å¿…åšå¥½æ’é˜Ÿ1-2å°æ—¶çš„å¿ƒç†å‡†å¤‡ã€‚', address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºç‰›è¡—è¥¿é‡Œå•†ä¸š1å·æ¥¼' },
                { id: 2, name: 'å—é—¨æ¶®è‚‰', cuisine: 'äº¬å‘³æ¶®è‚‰', priceSymbol: 'Â¥Â¥', priceValue: 110, district: 'ä¸œåŸ', topPick: false, hasMutton: true, rating: 9.2, travelTime: 40, dishes: 'æ‰‹åˆ‡é²œç¾Šè‚‰ã€éº»é…±', feature: 'ä¸èšå®æºé½åçš„ç»å…¸é€‰æ‹©ï¼ŒåŒæ ·éœ€è¦æœ‰æ’é˜Ÿçš„è€å¿ƒã€‚', address: 'åŒ—äº¬å¸‚ä¸œåŸåŒºæ°¸å†…ä¸œè¡—ä¸œé‡Œ13å·æ¥¼' },
                { id: 26, name: 'è¥¿ç›´é—¨ç£å™¨æ¶®è‚‰', cuisine: 'äº¬å‘³æ¶®è‚‰', priceSymbol: 'Â¥Â¥', priceValue: 115, district: 'è¥¿åŸ', topPick: false, hasMutton: true, rating: 8.9, travelTime: 40, dishes: 'æ‰‹åˆ‡ç¾Šè‚‰ã€ç¾Šè‚‰ä¸²', feature: 'ç¤¾åŒºæ¨èçš„æ€§ä»·æ¯”ä¹‹é€‰ï¼Œä»¥è‚‰è´¨å¥½ã€ä»·æ ¼ä¼˜ã€ç¾Šè‚‰ä¸²ç¾å‘³è‘—ç§°ã€‚', address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºèµµç™»ç¦¹è·¯123å·' },
                { id: 9, name: 'çƒ¤è‚‰åˆ˜', cuisine: 'ç‚™å­çƒ¤è‚‰', priceSymbol: 'Â¥Â¥', priceValue: 100, district: 'è¥¿åŸ', topPick: false, hasMutton: true, rating: 9.1, travelTime: 50, dishes: 'çƒ¤ç‰›è‚‰ã€çªå¤´ç‰‡é…è‡­è±†è…', feature: 'ç™¾å¹´è€å­—å·ï¼Œä½“éªŒä¼ ç»Ÿé£å‘³å’Œâ€œå¤§å£åƒè‚‰â€è±ªæƒ…çš„æœ€ä½³åœºæ‰€ã€‚', address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºé˜¡å„¿èƒ¡åŒ41å·' },
                { id: 27, name: 'çƒ¤è‚‰å®›', cuisine: 'ç‚™å­çƒ¤è‚‰', priceSymbol: 'Â¥Â¥', priceValue: 120, district: 'è¥¿åŸ', topPick: false, hasMutton: true, rating: 9.0, travelTime: 50, dishes: 'çƒ¤ç‰›è‚‰ã€çƒ¤ç¾Šè‚‰', feature: 'ä¸çƒ¤è‚‰åˆ˜é½åçš„ç™¾å¹´è€åº—ï¼Œäº¬åŸç‚™å­çƒ¤è‚‰ç•Œçš„æ³°æ–—ã€‚', address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºå—ç¤¼å£«è·¯58å·' },
                { id: 28, name: 'ä¸œç›´é—¨çƒ§çƒ¤ (å›é¾™è§‚åº—)', cuisine: 'ç‰¹è‰²çƒ§çƒ¤', priceSymbol: 'Â¥Â¥', priceValue: 90, district: 'æ˜Œå¹³', topPick: false, hasMutton: true, rating: 8.8, travelTime: 80, dishes: 'ç¾Šè‚‰ä¸²ã€å„ç±»çƒ§çƒ¤', feature: 'V2EXç”¨æˆ·å£ä¸­çš„â€œåƒè¿‡æœ€å¥½åƒçš„çƒ§çƒ¤â€ï¼Œå±äºæ·±åº¦ç©å®¶çš„æ¨èã€‚', address: 'åŒ—äº¬å¸‚æ˜Œå¹³åŒºå›é¾™è§‚è¥¿å¤§è¡—111å·' },
                { id: 29, name: 'è€å››çƒ¤ä¸² (åé‡Œå ¡åº—)', cuisine: 'ç‰¹è‰²çƒ§çƒ¤', priceSymbol: 'Â¥', priceValue: 70, district: 'æœé˜³', topPick: false, hasMutton: true, rating: 8.7, travelTime: 15, dishes: 'ç¾Šè‚‰ä¸²ã€æ¿ç­‹', feature: 'ç¯å¢ƒæ™®é€šï¼Œä½†ä»¥å‡ºè‰²çš„å‘³é“å’Œæé«˜çš„æ€§ä»·æ¯”åœ¨é£Ÿå®¢ä¸­äº«æœ‰ç››èª‰ã€‚', address: 'åŒ—äº¬å¸‚æœé˜³åŒºåé‡Œå ¡è·¯1å·' },
                { id: 23, name: 'å…­æ—¥éƒ½çƒ¤ç‰›å†…è„', cuisine: 'æ—¥æ–™', priceSymbol: 'Â¥Â¥Â¥', priceValue: 200, district: 'æœé˜³', topPick: false, hasMutton: false, rating: 9.3, travelTime: 20, dishes: 'çƒ¤ç‰›å†…è„æ‹¼ç›˜', feature: 'è¯„ä»·æé«˜ï¼Œèƒ½è®©äººâ€œå›å‘³å¥½å‡ å¤©â€çš„æ°´å¹³ï¼Œæ˜¯æ—¥å¼çƒ§çƒ¤çˆ±å¥½è€…çš„é«˜é˜¶é€‰æ‹©ã€‚', address: 'åŒ—äº¬å¸‚æœé˜³åŒºéº¦å­åº—è¥¿è¡—39å·' },
                { id: 30, name: 'é›…å±…å°é¦†', cuisine: 'ç²¾è‡´ä¸­é¤', priceSymbol: 'Â¥Â¥Â¥', priceValue: 180, district: 'è¥¿åŸ', topPick: false, hasMutton: false, rating: 8.9, travelTime: 45, dishes: 'èŠ±é›•é¸¡ã€æ¯›è¡€æ—º', feature: 'å£ç¢‘æå¥½çš„ä¸­é«˜ç«¯å®¶å¸¸èœï¼Œæ‹›ç‰Œèœå¤‡å—æ¨å´‡ï¼Œé€‚åˆæœ‹å‹å°èšã€‚', address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºè½¦å…¬åº„å¤§è¡—9å·é™¢' },
                { id: 21, name: 'æ·®æ‰¬åºœ', cuisine: 'ç²¾è‡´ä¸­é¤', priceSymbol: 'Â¥Â¥Â¥', priceValue: 250, district: 'ä¸œåŸ', topPick: false, hasMutton: false, rating: 9.2, travelTime: 35, dishes: 'æ‰¬å·ç‚’é¥­ã€ç”Ÿç…åŒ…ã€èŸ¹ç²‰ç‹®å­å¤´', feature: 'è¢«èª‰ä¸ºâ€œæœ€ä¾¿å®œçš„é»‘çç é¤å…â€ï¼Œèœå“ç²¾è‡´ä¸”ä»½é‡è¶³ã€‚', address: 'åŒ—äº¬å¸‚ä¸œåŸåŒºå®‰å®šé—¨å¤–å¤§è¡—198å·' },
                { id: 31, name: 'ä¸‰æ³‰å†·é¢', cuisine: 'ä¸œåŒ—èœ', priceSymbol: 'Â¥', priceValue: 50, district: 'æœé˜³', topPick: false, hasMutton: false, rating: 8.6, travelTime: 25, dishes: 'å†·é¢ã€é”…åŒ…è‚‰ã€æ‰“ç³•', feature: 'å†·é¢ã€é”…åŒ…è‚‰ã€æ‰“ç³•å£å‘³åœ°é“ï¼Œæ˜¯ä½“éªŒä¸œåŒ—é£æƒ…çš„å¥½å»å¤„ã€‚', address: 'åŒ—äº¬å¸‚æœé˜³åŒºé›…å®è·¯8å·' },
                { id: 24, name: 'æ»¡è®°çƒ§é¥¼', cuisine: 'äº¬å‘³å°åƒ', priceSymbol: 'Â¥', priceValue: 10, district: 'è¥¿åŸ', topPick: false, hasMutton: true, rating: 8.8, travelTime: 55, dishes: 'ç‰›è‚‰çƒ§é¥¼', feature: 'ä»…éœ€5å…ƒä¸€ä¸ªçš„ç‰›è‚‰çƒ§é¥¼ï¼Œé¦™é…¥å¯å£ï¼Œæ˜¯ç‰›è¡—å¿…é¡»æ’é˜Ÿå“å°çš„ä¼ å¥‡å°åƒã€‚', address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºç‰›è¡—è¾“å…¥èƒ¡åŒ3å·' },
                { id: 22, name: 'ç´«å…‰å›­', cuisine: 'æ¸…çœŸèœ', priceSymbol: 'Â¥', priceValue: 80, district: 'é€šå·', topPick: false, hasMutton: true, rating: 8.9, travelTime: 65, dishes: 'ç‚’ç–™ç˜©ã€ç‚¸æ¾è‚‰ã€çƒ¤é¸­', feature: 'æ€§ä»·æ¯”è¶…é«˜çš„æ¸…çœŸè€å­—å·ï¼Œå‘³é“æ­£å®—ï¼Œæ·±å—æœ¬åœ°äººå–œçˆ±ï¼Œå®¶åº­èšé¤çš„ç»ä½³é€‰æ‹©ã€‚', address: 'åŒ—äº¬å¸‚é€šå·åŒºé€šèƒ¡å¤§è¡—23å·' }
            ];
            
            const modal = document.getElementById('restaurant-modal');
            const closeModalBtn = document.getElementById('close-modal');
            const toggleFiltersBtn = document.getElementById('toggle-filters-btn');
            const filtersSection = document.getElementById('filters');
            const selectedFiltersDisplay = document.getElementById('selected-filters-display');
            const state = {
                cuisine: [],
                price: [],
                time: [],
                district: [],
                special: []
            };
            let ratingDistributionChart, ratingRankChart;

            const filterConfig = {
                'cuisine-filters': { type: 'cuisine', title: 'å…¨éƒ¨èœç³»', items: [...new Set(restaurants.map(r => r.cuisine))] },
                'price-filters': { type: 'price', title: 'æ‰€æœ‰ä»·ä½', items: ['Â¥', 'Â¥Â¥', 'Â¥Â¥Â¥'] },
                'time-filters': { type: 'time', title: 'ä¸é™', items: { '<30åˆ†é’Ÿ': '0-30', '30-60åˆ†é’Ÿ': '31-60', '>60åˆ†é’Ÿ': '61+' } },
                'district-filters': { type: 'district', title: 'å…¨éƒ¨åŒºåŸŸ', items: [...new Set(restaurants.map(r => r.district))] },
                'special-filters': { type: 'special', title: 'æ— ', items: ['ç¥çº§é¤å…', 'å«ç¾Šè‚‰'] }
            };

            const renderFilters = () => {
                for (const [containerId, config] of Object.entries(filterConfig)) {
                    const container = document.getElementById(containerId);
                    if (!container) continue;

                    let buttonsHTML = `<button class="filter-btn px-3 py-1.5 text-sm font-medium rounded-full bg-white shadow-sm hover:bg-gray-100 ${state[config.type].length === 0 ? 'active' : ''}" data-filter="all" data-type="${config.type}">${config.title}</button>`;
                    const items = Array.isArray(config.items) ? config.items.map(item => ({ text: item, value: item })) : Object.entries(config.items).map(([text, value]) => ({ text, value }));
                    
                    buttonsHTML += items.map(({ text, value }) => `
                        <button class="filter-btn px-3 py-1.5 text-sm font-medium rounded-full bg-white shadow-sm hover:bg-gray-100 ${state[config.type].includes(value) ? 'active' : ''}" data-filter="${value}" data-type="${config.type}">${text}</button>
                    `).join('');
                    container.innerHTML = buttonsHTML;
                }
            };

            const updateSelectedFiltersDisplay = () => {
                let activeFiltersHTML = '';
                let count = 0;
                for (const [type, filters] of Object.entries(state)) {
                    if (filters.length > 0) {
                        filters.forEach(filter => {
                            let text = filter;
                            // Find text representation for special values like time ranges
                            if (type === 'time') {
                                for (const [key, val] of Object.entries(filterConfig['time-filters'].items)) {
                                    if (val === filter) text = key;
                                }
                            }
                            activeFiltersHTML += `<span class="bg-gray-200 text-gray-800 px-2 py-1 rounded-full text-sm font-medium">${text}</span>`;
                            count++;
                        });
                    }
                }
                selectedFiltersDisplay.innerHTML = count > 0 ? activeFiltersHTML : '<span class="text-gray-500">æ˜¾ç¤ºæ‰€æœ‰é¤å… (ç‚¹å‡»å±•å¼€ç­›é€‰)</span>';
            };
            
            const getRatingClass = (rating) => (rating >= 9.0 ? 'bg-green-100 text-green-800' : rating >= 8.5 ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800');
            const getRatingText = (rating) => (rating >= 9.5 ? 'ç¥çº§' : rating >= 9.0 ? 'å“è¶Š' : rating >= 8.5 ? 'ä¼˜ç§€' : 'ä¸é”™');

            const restaurantCardHTML = (r) => `
                <div class="restaurant-card relative bg-white rounded-xl overflow-hidden shadow-md cursor-pointer" data-id="${r.id}">
                    ${r.topPick ? '<span class="absolute top-0 right-0 bg-amber-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10">ç¥çº§</span>' : ''}
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-xl text-[#A75C3B] pr-2">${r.name}</h3>
                            ${r.hasMutton ? '<span class="flex-shrink-0 bg-gray-200 text-gray-700 w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm">ç¾Š</span>' : ''}
                        </div>
                        <p class="text-gray-600 text-sm mb-4 h-12">${r.feature.substring(0, 50)}...</p>
                        <div class="flex justify-between items-center text-xs">
                            <div class="flex flex-wrap gap-2">
                                <span class="bg-sky-100 text-sky-800 px-2 py-1 rounded-full font-medium">${r.cuisine}</span>
                                <span class="bg-emerald-100 text-emerald-800 px-2 py-1 rounded-full font-medium">${r.priceSymbol}</span>
                            </div>
                            <span class="font-bold px-2 py-1 rounded-full ${getRatingClass(r.rating)}">è¯„åˆ† ${r.rating}</span>
                        </div>
                    </div>
                </div>`;
            
            const filterAndRender = () => {
                const filtered = restaurants.filter(r => {
                    const cuisineMatch = state.cuisine.length === 0 || state.cuisine.includes(r.cuisine);
                    const priceMatch = state.price.length === 0 || state.price.includes(r.priceSymbol);
                    const districtMatch = state.district.length === 0 || state.district.includes(r.district);
                    const specialMatch = state.special.length === 0 || state.special.every(spec => (spec === 'ç¥çº§é¤å…' && r.topPick) || (spec === 'å«ç¾Šè‚‰' && r.hasMutton));
                    const timeMatch = state.time.length === 0 || state.time.some(t => (t === '0-30' && r.travelTime <= 30) || (t === '31-60' && r.travelTime > 30 && r.travelTime <= 60) || (t === '61+' && r.travelTime > 60));
                    return cuisineMatch && priceMatch && districtMatch && specialMatch && timeMatch;
                });
                
                const container = document.getElementById('restaurants-container');
                container.innerHTML = filtered.length > 0 ? filtered.map(restaurantCardHTML).join('') : '';
                document.getElementById('no-results').classList.toggle('hidden', filtered.length > 0);
                container.querySelectorAll('.restaurant-card').forEach(card => card.addEventListener('click', () => openModal(card.dataset.id)));
                renderCharts(filtered);
                updateSelectedFiltersDisplay();
            };

            const handleFilterClick = (e) => {
                const button = e.target.closest('.filter-btn');
                if (!button) return;

                const { filter, type } = button.dataset;

                if (filter === 'all') {
                    state[type] = [];
                } else {
                    const index = state[type].indexOf(filter);
                    if (index > -1) {
                        state[type].splice(index, 1);
                    } else {
                        state[type].push(filter);
                    }
                }
                
                renderFilters();
                filterAndRender();
            };
            
            const openModal = (id) => {
                const r = restaurants.find(r => r.id == id);
                document.getElementById('modal-name').textContent = r.name;
                document.getElementById('modal-cuisine').textContent = r.cuisine;
                document.getElementById('modal-price').textContent = r.priceSymbol;
                const ratingSpan = document.getElementById('modal-rating');
                ratingSpan.textContent = `${getRatingText(r.rating)} ${r.rating}`;
                ratingSpan.className = `font-bold px-2 py-1 rounded-full text-sm ${getRatingClass(r.rating)}`;
                document.getElementById('modal-time').textContent = `~${r.travelTime}åˆ†é’Ÿ`;
                document.getElementById('modal-dishes').textContent = r.dishes;
                document.getElementById('modal-feature').textContent = r.feature;
                document.getElementById('address-text').textContent = r.address;
                modal.classList.remove('invisible', 'opacity-0');
                document.body.style.overflow = 'hidden';
            };

            const closeModal = () => {
                modal.classList.add('invisible', 'opacity-0');
                document.body.style.overflow = '';
            };
            
            const renderCharts = (data) => {
                if (ratingDistributionChart) ratingDistributionChart.destroy();
                if (ratingRankChart) ratingRankChart.destroy();
                
                const donutCtx = document.getElementById('ratingDistributionChart').getContext('2d');
                const barCtx = document.getElementById('ratingRankChart').getContext('2d');

                if (data.length === 0) {
                     donutCtx.clearRect(0, 0, donutCtx.canvas.width, donutCtx.canvas.height);
                     barCtx.clearRect(0, 0, barCtx.canvas.width, barCtx.canvas.height);
                    return;
                }

                const ratingTiers = { 'ç¥çº§ (9.5+)': 0, 'å“è¶Š (9.0-9.4)': 0, 'ä¼˜ç§€ (8.5-8.9)': 0 };
                data.forEach(r => {
                    if (r.rating >= 9.5) ratingTiers['ç¥çº§ (9.5+)']++;
                    else if (r.rating >= 9.0) ratingTiers['å“è¶Š (9.0-9.4)']++;
                    else if (r.rating >= 8.5) ratingTiers['ä¼˜ç§€ (8.5-8.9)']++;
                });

                ratingDistributionChart = new Chart(donutCtx, {
                    type: 'doughnut', data: { labels: Object.keys(ratingTiers), datasets: [{ data: Object.values(ratingTiers), backgroundColor: ['#e67e22', '#27ae60', '#f1c40f'] }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                });

                const sortedByRating = [...data].sort((a, b) => b.rating - a.rating);
                ratingRankChart = new Chart(barCtx, {
                    type: 'bar', data: { labels: sortedByRating.map(r => r.name), datasets: [{ label: 'è¯„åˆ†', data: sortedByRating.map(r => r.rating), backgroundColor: sortedByRating.map(r => r.rating >= 9.0 ? 'rgba(39, 174, 96, 0.6)' : 'rgba(241, 196, 15, 0.6)') }] },
                    options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { x: { beginAtZero: false, suggestedMin: 8.0 } } }
                });
            };

            const header = document.querySelector('header');
            const observer = new IntersectionObserver(([e]) => {
                const isCollapsed = e.intersectionRatio < 1;
                filtersSection.classList.toggle('collapsed', isCollapsed);
                toggleFiltersBtn.classList.toggle('hidden', !isCollapsed);
                toggleFiltersBtn.classList.toggle('opacity-0', !isCollapsed);
            }, { threshold: [1] });
            observer.observe(header);

            toggleFiltersBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            selectedFiltersDisplay.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            document.getElementById('filters').addEventListener('click', handleFilterClick);
            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => e.target === modal && closeModal());

            renderFilters();
            filterAndRender();
        });
    </script>
</body>
</html>
